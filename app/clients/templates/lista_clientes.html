{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-4 py-8">
  <!-- Buscador -->
  <div class="mb-8">
    <div class="max-w-md mx-auto">
      <div class="relative">
        <input 
          type="text" 
          id="dni-search"
          placeholder="Buscar cliente por DNI..."
          class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500"
          maxlength="8"
        >
        <button 
          id="search-btn"
          class="absolute right-2 top-2 text-gray-500 hover:text-blue-500"
        >
          üîç
        </button>
      </div>
    </div>
  </div>

  <!-- Tabla de Clientes -->
  <div class="bg-white shadow-md rounded-lg overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">DNI</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nombre Completo</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estado PEP</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Fecha Registro</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200" id="clients-table-body">
        {% for cliente in clientes %}
        <tr>
          <td class="px-6 py-4 whitespace-nowrap">{{ cliente.dni }}</td>
          <td class="px-6 py-4">{{ cliente.nombre_completo }}</td>
          <td class="px-6 py-4">
            {% if cliente.pep %}
            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">PEP</span>
            {% else %}
            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">No PEP</span>
            {% endif %}
          </td>
          <td class="px-6 py-4">{{ cliente.fecha_registro.strftime('%d/%m/%Y') }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Paginador -->
  <div class="mt-4 flex justify-center">
    <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px">
      {% if page > 1 %}
      <a href="?page={{ page - 1 }}" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
        Anterior
      </a>
      {% endif %}
      
      <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
        P√°gina {{ page }} de {{ total_pages }}
      </span>

      {% if page < total_pages %}
      <a href="?page={{ page + 1 }}" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
        Siguiente
      </a>
      {% endif %}
    </nav>
  </div>
</div>

<script>
document.getElementById('dni-search').addEventListener('input', function(e) {
  this.value = this.value.replace(/[^0-9]/g, '');
});

document.getElementById('search-btn').addEventListener('click', function() {
  const dni = document.getElementById('dni-search').value;
  if (dni.length === 8) {
    window.location.href = `?dni=${dni}`;
  } else {
    alert('El DNI debe tener 8 d√≠gitos');
  }
});
</script>
{% endblock %}